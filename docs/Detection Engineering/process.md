# Process

## Detection Story

- Collecting ideas in a way that sets your detection engineering team up for success is crucial.
- Should include (at a minimum):
    - Reason
    - Data Sources
    - Example logic
    - Expected Volume
    - Supporting Artifacts

- Potential Sources
    - Peers
    - Management
    - Blogs or Articles
    - Past Attacks
    - Customer Requests

## Steps

=== ":material-numeric-1-circle-outline: Research"

    - A good detection requires full understanding of the idea.
        - Research and documentation findings related to the artifact(s) in question as you go
        - Document different avenues as you go down, different things you look at, etc.
        - You never know what might be useful later!

=== ":material-numeric-2-circle-outline: Query"

    - Query is informed by your research, in what to look for, and possible things to execlude.
    - Prototype a number of queries as you go and evaluate the results.
    - Finding a balance
        - Too broad : Risk burnout and high volume, missing key events buried in the pile
        - Middle Ground : Balanced between volume and fidelity
        - Too Narrow : Specific exact commands, any small change and you miss the event

=== ":material-numeric-3-circle-outline: Back test"

    - Estimating the volume is good thing to do *before* your SOC comes to you with pitchforks in hand
        - Run your query against the dataset it will be against in production
        - 30 days should be the minimum, 90 days is ideal
        - Save your results, use as evidence later when you propose a severity/priority
        - Use this as an opportunity to look for more filtering opportunities

=== ":material-numeric-4-circle-outline: Canary"

    - An important part of a detection, a canary can be run to ensure your detect still works as intended
        - Logic can range from extremely complex to very simple 
        - Ideally should be run at a scheduled interval, with reporting when a canary fails, or fails to trigger the intended rule
        
    - Best: Having dedicated canary infrastructure w/ scheduling
    - Good: Running Canaries regularly
    - Bad: Testing your rule once when you release it

=== ":material-numeric-5-circle-outline: Documentation"

    - Probably the most important step for a number of reasons
        - Needs to spell out all the important details on the detection, notes regarding anything filtered, and potentially information on how to respond to an alert generated by it.
        - ADS(Alerting Detection Strategy) Framework
            - Is Open-source and helps ensure all the bases are covered. You should consider filling this in from the get-go, that way by Step 5 you are most of the way done.

=== ":material-numeric-6-circle-outline: Onboarding"

    - This is where you see return for your efforts, by onboarding your detection into the SIEM
        - A fairly simple part of the process-effectively enabling your rule in the production side of the SIEM
        - Still important to ensure suppressions, throttling, etc. are all configured properly
        - This is where you would submit a change ticket or make a PR
    - Consider a "burn-in period" for your detection if it risks having high volume. This is a period where your detection is enabled in production, but doesn't output any alerts yet.

=== ":material-numeric-7-circle-outline: Continuous Improvement"

    - Detection engineering doesn't stop when you hit approve or enable, it should be a continuous process
        - There are a number of reasons your detection may need to be updated: new research, filters, or fixes to name a few
        - This may require an updated change request or PR
        - It is also recommended for large changes to do another backtest and review of the alert volume
    - Risk Management, should be considered when you develop and improve rules. You can't catch everything - find a balance of volume and fidelity.

## Risk

### Filters & Risk

- There will almost always be risk involved when you filter activity out and develop detections- You have to manage and balance that risk just like with everything else.

#### Avoidance

- Filtering very selectively and dealing with more potential volume.

#### Transfer

- Scheduling threat hunts to look for a certain TTP on a regular cadence

#### Acceptance

- Sometimes a high volume detection is not worth the value it brings.

#### Mitigation

- Having other detections for similar or related TTPs (defence in depth)
